generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            String                 @id @default(uuid())
  createdAt     DateTime               @default(now())
  updatedAt     DateTime               @updatedAt
  email         String                 @unique
  username      String                 @unique
  passwordHash  String
  subscriptions SubscriptionToSeries[]
  playBacks     ProgressOnPlayback[]
  manualScrapes Scrape[]
}

model Creator {
  id                 String  @id @default(uuid())
  name               String
  publicBroadcasting Boolean @default(false)
}

model SubscriptionToSeries {
  userId   String
  seriesId String
  created  DateTime @default(now())
  updated  DateTime @updatedAt
  User     User     @relation(fields: [userId], references: [id])
  Series   Series   @relation(fields: [seriesId], references: [id])

  @@id([userId, seriesId])
}

model ProgressOnPlayback {
  userId    String
  episodeId String
  created   DateTime @default(now())
  updated   DateTime @updatedAt
  users     User     @relation(fields: [userId], references: [id])
  episodes  Episode  @relation(fields: [episodeId], references: [id])

  @@id([userId, episodeId])
}

model Series {
  id            String                 @id @default(uuid())
  title         String
  description   String
  language      String
  image         String
  link          String                 @unique
  explicit      Boolean
  pubDate       DateTime
  lastBuildDate DateTime
  ttl           Int                    @default(5)
  created       DateTime               @default(now())
  updated       DateTime               @updatedAt
  episodes      Episode[]
  categories    Category[]
  subscriptions SubscriptionToSeries[]
  scrapedBy     Scrape[]
}

model Episode {
  id              String               @id @default(uuid())
  guid            String               @unique
  title           String
  seriesId        String
  description     String
  descriptionHTML String
  pubDate         DateTime
  enclosure       String
  image           String
  link            String
  duration        Int
  created         DateTime             @default(now())
  updated         DateTime             @updatedAt
  series          Series               @relation(fields: [seriesId], references: [id])
  updatedIn       Scrape[]
  categories      Category[]
  playbacks       ProgressOnPlayback[]
}

model Category {
  id       String    @id @default(uuid())
  name     String    @unique
  created  DateTime  @default(now())
  series   Series[]
  episodes Episode[]
}

model Scrape {
  id              String    @id @default(uuid())
  seriesId        String
  created         DateTime  @default(now())
  completed       DateTime?
  userId          String?
  manual          Boolean   @default(false)
  updatedSeries   Boolean   @default(false)
  updatedEpisodes Episode[]
  initiator       User?     @relation(fields: [userId], references: [id])
  series          Series    @relation(fields: [seriesId], references: [id])
}
