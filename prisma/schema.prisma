generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model User {
  id            String                 @id @default(uuid())
  createdAt     DateTime               @default(now())
  updatedAt     DateTime               @updatedAt
  email         String                 @unique
  username      String                 @unique
  subscriptions SubscriptionToSeries[]
  playBacks     ProgressOnPlayback[]
}

model Creator {
  id                 String  @id @default(uuid())
  name               String
  publicBroadcasting Boolean @default(false)
}

model SubscriptionToSeries {
  userId   String
  seriesId String
  created  DateTime @default(now())
  updated  DateTime @updatedAt
  User     User     @relation(fields: [userId], references: [id])
  Series   Series   @relation(fields: [seriesId], references: [id])

  @@id([userId, seriesId])
}

model ProgressOnPlayback {
  userId    String
  episodeId String
  created   DateTime @default(now())
  updated   DateTime @updatedAt
  user      User     @relation(fields: [userId], references: [id])
  episodes  Episode  @relation(fields: [episodeId], references: [id])

  @@id([userId, episodeId])
}

model Series {
  id            String                 @id @default(uuid())
  title         String
  description   String                 @db.VarChar(512)
  language      String
  image         String
  link          String                 @unique
  explicit      Boolean
  pubDate       DateTime
  lastBuildDate DateTime
  ttl           Int                    @default(5)
  created       DateTime               @default(now())
  updated       DateTime               @updatedAt
  episodes      Episode[]
  keywords      Keyword[]
  subscriptions SubscriptionToSeries[]
}

model Episode {
  id              String               @id @default(uuid())
  guid            String               @unique
  title           String
  seriesId        String
  description     String               @db.VarChar(512)
  descriptionHTML String               @db.VarChar(512)
  pubDate         DateTime
  enclosure       String
  image           String
  link            String
  duration        Int
  created         DateTime             @default(now())
  updated         DateTime             @updatedAt
  series          Series               @relation(fields: [seriesId], references: [id])
  keywords        Keyword[]
  playbacks       ProgressOnPlayback[]
}

model Keyword {
  id       String    @id @default(uuid())
  name     String    @unique
  created  DateTime  @default(now())
  series   Series[]
  episodes Episode[]
}
